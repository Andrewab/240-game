<!DOCTYPE html>
<html>


<head>
	<link rel="stylesheet" type="text/css" href="gameBackground.css">
	<link rel="stylesheet" type="text/css" href="fallingBlocks.css">
	<div class="gameBackground"></div>
<!--	<div class="divGameBackground"></div> -->
</head>
<body>
	<script src="randomEquation.js"></script>
<!--
	<div id = "firstFallOption" class = "fallingBlocks" style = "animation-name: blockFall1"></div>
	<div id = "secondFallOption" class = "fallingBlocks" style="animation-name: blockFall2"></div>
	<div id = "thirdFallOption" class = "fallingBlocks" style = "animation-name: blockFall3"></div>
-->
	<script type="text/javascript">
		
		//var equation = generateAddition();
		var go; //this variable will hold the interval for blockCannon. Initialized in start(gap).
		var counter = 0;
		var blockList = new Array(); //whats 9 + 10?
		var blockFrequency = 1000;
		//document.getElementById("firstFallOption").innerHTML = equation;
		start(blockFrequency);



		//start shooting blocks every gap millis
		function start(gap){
			//The function setInterval calls the method blockCannon every gam milliseconds
			go = setInterval(blockCannon, gap);
		}

		//stop shooting blocks every gap millis
		function stop(){
			clearInterval(go);
		}

		//Shoot blocks with random equations in random collumns/files.
		function blockCannon() {
			++counter;
			console.log(counter);	
			var currentBlockId = "block" + counter;
			var randomEquation = generateAddition();
			makeBlock(currentBlockId,randomEquation);
			var newBlock = {id: currentBlockId, equation: randomEquation};
			blockList.push(newBlock);
			console.log(JSON.stringify(blockList));
	//		checkfinishedBlocks();
		}
		
		function makeBlock(newBlockId, equation) {
			var rand = parseInt(Math.random() * 3, 10) + 1; //create a random number between 1 and 3 inclusive
			var block = document.createElement('div');
			block.addEventListener("webkitAnimationEnd", animationEndListener);
			block.setAttribute("id",newBlockId);
			block.setAttribute("class", "fallingBlocks");
			switch(rand){
			case (1) : block.setAttribute("style","animation-name: blockFall1"); break;
			case (2) : block.setAttribute("style","animation-name: blockFall2"); break;
			default : block.setAttribute("style","animation-name: blockFall3"); break;
			}
			document.body.appendChild(block);
			block.innerHTML = equation;

		}

		function animationEndListener(e) {
			removeBlockId = e.target.getAttribute("id");
			for(i = 0; i < blockList.length; i++) {
				if(removeBlockId == blockList[i].id){
					blockList.splice(i,1);
				}
			}
			e.target.remove();
			console.log("Block id: " + removeBlockId);
		}


	</script>
	<!--	<label for="Answer: "> Username</label>-->
	<textarea id = "userGuess" cols="40" rows="5" onkeypress="process(event)"></textarea>
<script type="text/javascript">
	var guess = "";
	function process(e) {
			if (e.keyCode == 13) {
				e.preventDefault();
				guess = document.getElementById("userGuess").value;
				//blockList.forEach(getAnswer);
				for(var i = 0; i < blockList.length; i++){
					if(getAnswer(blockList[i], i) == true) {
						break;
					}	
				}
				document.getElementById("userGuess").value = "";
//				document.getElementById("userGuess").value = document.getElementById("userGuess").defaultValue;
			} 
	}
	function getAnswer(block, iterator) {
		asArray = block.equation.split(" ");
		num1 = parseInt(asArray[0]);
		symbol = asArray[1];
		num2 = parseInt(asArray[2]);
		result = -11;
		if (symbol == "+"){
			result = num1 + num2;
			console.log("checkGuess'" + guess+ "'");
			console.log("result'" + result + "'");
			if(result == parseInt(guess)) {
				document.getElementById(block.id).remove();//where im at rnzzzzzzzzzzz
				blockList.splice(iterator,1);
				console.log("Block removed from user input:" + block.id);
				return true;
			}
			else{
				console.log("Didnt find block");
				return false;
			}
		}
		if (symbol == "-"){
			result = num1 - num2;
			if(result == parseInt(guess)) {
				block.target.remove();
			}
		}
	}
</script>
	<!--<div>h1</div> -->
</body>
	</html>